# 06. 단위 테스트 스타일

## 단위 테스트 스타일

### 출력 기반 테스트 ( Output-based testing )

함수형 테스트 스타일  ( Functional )  
테스트 대상 시스템에 입력을 넣고 생성되는 출력을 점검

![05_Test_output_based.png](05_Test_output_based.png)

### 상태 기반 테스트 ( State-based testing )

작업이 완료 된 후 시스템의 상태( SUT 시스템 자체 혹은 Class 상태, 파일 시스템이나 데이터베이스 등 상태)를 확인

![06_Test_state_based.png](06_Test_state_based.png)

### 통신 기반 테스트 ( Communication-based testing )

Mock 을 사용하여 테스트 대상 시스템과 협력자 간의 통신을 검증

![07_Test_comm_based.png](07_Test_comm_based.png)

> **테스트 분파에 따른 선호도**  
> 공통 : 출력 기반 스타일  
> 고전파 : 상태 기반 스타일 선호  
> 런던파 : 통신 기반 스타일 선호

## 단위 테스트 스타일과 테스트 4대 요소

### 회귀방지와 피드백 속도

테스트 중에 실행되는 코드의 양과 실행 속도는 단위 테스트의 스타일과 큰 연관성은 없다.  
다만, 통신 기반 테스트에서 작은 코드 조각에 치중하고, 모든 테스트를 Mock 으로 대체하면, 피상적인 테스트가 된다.

### 리팩터링 내성

- 출력 기반 테스트  
  테스트 대상의 Method 의 결과값을 검증하기에 리팩터링 내성에 가장 좋다.

- 상태 기반 테스트  
  테스트 결과값 뿐만 아니라, 상태 또한 검증을 하므로 상태를 확인하기 위한 테스트와 구현 세부 코드간의 결합도가 높아진다.

- 통신 기반 테스트
  시스템 내부의 상호 작용의 Stub 과 Mock 으로 일괄 대체한다면, 테스트의 허위 경보에 가장 취약하다.  
  즉, 외부 환경과의 통신을 검증하기 위한 Mock 은 괜찮지만, 내부 통신을 위한 테스트 대역의 사용은 상호 작용의 검증만 치중될 뿐, 결과를 보장하지 못한다.

### 유지보수성

- 출력 기반 테스트  
  Method 의 출력을 검증하고, 외부 의존성이 약하기 때문에 유지보수성가 가장 높다.

- 상태 기반 테스트
  시스템의 상태를 확인하기 위한 테스트 구현이 더 필요하므로, 유지보수가 낮아진다.

- 통신 기반 테스트
  상호 작용 검증을 이한 테스트 대역이 필요하므로, 이를 별도 구현이 필요하다. 이에 따라 유지보수성이 가장 낮다.

> # 함수형 프로그래밍
> 수학적 함수( 숨은 입출력이 없는 함수)를 사용한 프로그래밍  
> 모든 입출력은 메서드 이름, 인수, 반환타입으로 구성된 Method Signature 를 명시해야 한다.  
> 호출 횟수에 상환없이 주어진 입력에 대해서 동일한 출력을 생성해야 한다.

> # 함수형 아키텍처
> 비즈니스 로직을 처리하는 코드와 사이트 이펙트를 일으키는 코드를 분리  
> 가변 셀은 입력 테이터를 함수형 코어에 전달하고, 함수형 코어는 비즈니스 로직을 처리한 이후에 사이드 이펙트를 일으키는 로직(데이터베이스와 같은 외부 의존성)으로 반환한다.    
> 테스트 관점에서 함수형 코어는 출력 기반 테스트, 그 외는 상태 기반 혹은 통신 기반 테스트( 혹은 통합 테스트, API 테스트 등) 으로 대체하는 것을 목표이다.