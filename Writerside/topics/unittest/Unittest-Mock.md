# 09. 목 처리에 대한 모범 사례

## Mock 의 가치

1. 시스템의 끝에서 상호 작용 검증하기
    - 시스템의 끝에서 비관리 의존성과의 상호 작용을 검증하라.
    - 이로 인해, 회귀방지(통합테스트로 검증된 코드가 증가)와 리팩터링 내성(코드의 세부 구현 사항에서 목을 분리)이 향상될 수 있다.

2. 시스템의 끝에 있는 클래스에 대해서 Spy 가 Mock 보다 좋다.
    - 검증단계에서 코드를 재사용하여 테스트 크기가 줄고, 가독성이 개선된다.

3. 통합 테스트에사만 목을 사용하고 단위테스트에서는 하지 않기
    - 도메인 모델과 컨트롤러 처리가 완벽하게 분리되었을 경우
   > 대부분의 시스템은 위와 같이 완벽하게 분리는 어렵다.  
   > 이상적인 테스트는 Mock 은 통합 테스트 에서만 사용하는 것이 좋지만, 경험상 대부분의 시스템 코드는 분리가 어렵고, 분리를 위한 리팩토링은 많은 공수가 소요된다.
   >
   {style="warning"}

4. 테스트 당 Mock 은 하나일 필요는 없다.
    - Mock 의 수는 비관리 의존성 수에만 의존한다.

5. 호출 횟수 검증
    - Mock 에 대한 예상되는 호출이 있는지, 예상치 못한 호출이 있는지 확인

6. 보유 타입만 Mock 으로 처리한다.
    - 서드파티 코드의 작동방식과 세부 기술 사항까지 모른다.
    - 어댑터를 통해 추상화를 구현하고, 이를 기반으로 System 과 라이브러리 와의 관계를 정의 한다.
   > 이는 테스트를 하고자 하는 코드에서 세부 구현 사항 외에 라이브러리 코드까지 테스트케이스를 작성할 필요 없이 이를 Mock 으로 처리하자는 의미로 받아 들인다.  
   > ex.) Database Connection Code
   >
   {style="note"}